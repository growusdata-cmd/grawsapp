generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-1.0.x"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id                     String       @id @default(uuid())
  name                   String
  email                  String       @unique
  password               String
  role                   Role         @default(CLIENT)
  isActive               Boolean      @default(true)
  createdAt              DateTime     @default(now())
  companyId              String?
  assignmentsAsAssigner  Assignment[] @relation("AssignmentAssigner")
  assignmentsAsInspector Assignment[] @relation("AssignmentInspector")
  inspections            Inspection[]
  company                Company?     @relation(fields: [companyId], references: [id])
}

model Company {
  id            String    @id @default(uuid())
  name          String
  address       String?
  contactPerson String?
  contactPhone  String?
  logoUrl       String?
  createdBy     String
  createdAt     DateTime  @default(now())
  projects      Project[]
  clients       User[]
}

model Project {
  id            String         @id @default(uuid())
  companyId     String
  name          String
  description   String?
  createdBy     String
  createdAt     DateTime       @default(now())
  assignments   Assignment[]
  formTemplates FormTemplate[]
  company       Company        @relation(fields: [companyId], references: [id])
}

model Assignment {
  id              String       @id @default(uuid())
  projectId       String
  inspectionBoyId String
  assignedBy      String
  status          String       @default("active")
  createdAt       DateTime     @default(now())
  assigner        User         @relation("AssignmentAssigner", fields: [assignedBy], references: [id])
  inspectionBoy   User         @relation("AssignmentInspector", fields: [inspectionBoyId], references: [id])
  project         Project      @relation(fields: [projectId], references: [id])
  inspections     Inspection[]
}

model Inspection {
  id            String           @id @default(uuid())
  assignmentId  String
  status        String           @default("draft")
  submittedAt   DateTime?
  createdAt     DateTime         @default(now())
  approvedAt    DateTime?
  reviewerNotes String?
  submittedBy   String
  assignment    Assignment       @relation(fields: [assignmentId], references: [id])
  submitter     User             @relation(fields: [submittedBy], references: [id])
  responses     InspectionData[]
}

model InspectionData {
  id           String       @id @default(uuid())
  inspectionId String
  fieldId      String
  value        String?
  field        FormTemplate @relation(fields: [fieldId], references: [id])
  inspection   Inspection   @relation(fields: [inspectionId], references: [id])
}

model FormTemplate {
  id           String           @id @default(uuid())
  projectId    String
  fieldLabel   String
  fieldType    String
  options      String?
  isRequired   Boolean          @default(false)
  displayOrder Int              @default(0)
  createdAt    DateTime         @default(now())
  project      Project          @relation(fields: [projectId], references: [id])
  responses    InspectionData[]
}

enum Role {
  ADMIN
  MANAGER
  INSPECTION_BOY
  CLIENT
}
